<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <title>Chat</title>
    </head>
    <body>
        <h2>Welcome to the Chat</h2>
        <form id="messageForm">
            <textarea id="message" placeholder="Type your message here" required></textarea>
            <button type="submit">Send</button>
        </form>
        <h3>Messages</h3>
        <ul id="messages"></ul>
        <script>
            const params= new URLSearchParams(window.location.search);
            const username= params.get('username');

            if(username){
                localStorage.setItem('username',username);

            }

            const form= document.getElementById('messageForm');
            const messagesList= document.getElementById('messages');

            form.addEventListener('submit', (e)=>{
                e.preventDefault();
                const message= document.getElementById('message').value;
                fetch('/send-message',{
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body:JSON.stringify({username,message})
                }).then(()=>{
                    document.getElementById('message').value= '';
                    loadMessages();
                });
            });
            function loadMessages(){
                fetch('/messages')
                .then(response => response.json())
                .then(data =>{
                    messagesList.innerHTML ='';
                    data.forEach(({username,message})=>{
                        const li=document.createElement('li');
                        li.textContent= `${username} : ${message}`;
                        messagesList.appendChild(li);

                    });

                });
            }
            loadMessages();
        </script>
    </body>
</html>